"use strict";const p=require("../../../../common/vendor.js"),w=require("./mescroll-uni-option.js"),g=require("./mescroll-i18n.js"),x=require("./wxs/mixins.js");function i(t,o){let e=this;e.version="1.3.7",e.options=t||{},e.isScrollBody=o||!1,e.isDownScrolling=!1,e.isUpScrolling=!1;let l=e.options.down&&e.options.down.callback;e.initDownScroll(),e.initUpScroll(),setTimeout(function(){(e.optDown.use||e.optDown.native)&&e.optDown.auto&&l&&(e.optDown.autoShowLoading?e.triggerDownScroll():e.optDown.callback&&e.optDown.callback(e)),e.isUpAutoLoad||setTimeout(function(){e.optUp.use&&e.optUp.auto&&!e.isUpAutoLoad&&e.triggerUpScroll()},100)},30)}i.prototype.extendDownScroll=function(t){i.extend(t,{use:!0,auto:!0,native:!1,autoShowLoading:!1,isLock:!1,offset:80,startTop:100,inOffsetRate:1,outOffsetRate:.2,bottomOffset:20,minAngle:45,textInOffset:"\u4E0B\u62C9\u5237\u65B0",textOutOffset:"\u91CA\u653E\u66F4\u65B0",textLoading:"\u52A0\u8F7D\u4E2D ...",textSuccess:"\u52A0\u8F7D\u6210\u529F",textErr:"\u52A0\u8F7D\u5931\u8D25",beforeEndDelay:0,bgColor:"transparent",textColor:"gray",inited:null,inOffset:null,outOffset:null,onMoving:null,beforeLoading:null,showLoading:null,afterLoading:null,beforeEndDownScroll:null,endDownScroll:null,afterEndDownScroll:null,callback:function(o){o.resetUpScroll()}})};i.prototype.extendUpScroll=function(t){i.extend(t,{use:!0,auto:!0,isLock:!1,isBoth:!0,callback:null,page:{num:0,size:10,time:null},noMoreSize:5,offset:150,textLoading:"\u52A0\u8F7D\u4E2D ...",textNoMore:"-- END --",bgColor:"transparent",textColor:"gray",inited:null,showLoading:null,showNoMore:null,hideUpScroll:null,errDistance:60,toTop:{src:null,offset:1e3,duration:300,btnClick:null,onShow:null,zIndex:9990,left:null,right:20,bottom:120,safearea:!1,width:72,radius:"50%"},empty:{use:!0,icon:null,tip:"~ \u6682\u65E0\u76F8\u5173\u6570\u636E ~",btnText:"",btnClick:null,onShow:null,fixed:!1,top:"100rpx",zIndex:99},onScroll:!1})};i.extend=function(t,o){if(!t)return o;for(let e in o)if(t[e]==null){let l=o[e];l!=null&&typeof l=="object"?t[e]=i.extend({},l):t[e]=l}else typeof t[e]=="object"&&i.extend(t[e],o[e]);return t};i.prototype.hasColor=function(t){if(!t)return!1;let o=t.toLowerCase();return o!="#fff"&&o!="#ffffff"&&o!="transparent"&&o!="white"};i.prototype.initDownScroll=function(){let t=this;t.optDown=t.options.down||{},!t.optDown.textColor&&t.hasColor(t.optDown.bgColor)&&(t.optDown.textColor="#fff"),t.extendDownScroll(t.optDown),t.isScrollBody&&t.optDown.native?t.optDown.use=!1:t.optDown.native=!1,t.downHight=0,t.optDown.use&&t.optDown.inited&&setTimeout(function(){t.optDown.inited(t)},0)};i.prototype.touchstartEvent=function(t){!this.optDown.use||(this.startPoint=this.getPoint(t),this.startTop=this.getScrollTop(),this.startAngle=0,this.lastPoint=this.startPoint,this.maxTouchmoveY=this.getBodyHeight()-this.optDown.bottomOffset,this.inTouchend=!1)};i.prototype.touchmoveEvent=function(t){if(!this.optDown.use)return;let o=this,e=o.getScrollTop(),l=o.getPoint(t);if(l.y-o.startPoint.y>0&&(o.isScrollBody&&e<=0||!o.isScrollBody&&(e<=0||e<=o.optDown.startTop&&e===o.startTop))&&!o.inTouchend&&!o.isDownScrolling&&!o.optDown.isLock&&(!o.isUpScrolling||o.isUpScrolling&&o.optUp.isBoth)){if(o.startAngle||(o.startAngle=o.getAngle(o.lastPoint,l)),o.startAngle<o.optDown.minAngle)return;if(o.maxTouchmoveY>0&&l.y>=o.maxTouchmoveY){o.inTouchend=!0,o.touchendEvent();return}o.preventDefault(t);let s=l.y-o.lastPoint.y;o.downHight<o.optDown.offset?(o.movetype!==1&&(o.movetype=1,o.isDownEndSuccess=null,o.optDown.inOffset&&o.optDown.inOffset(o),o.isMoveDown=!0),o.downHight+=s*o.optDown.inOffsetRate):(o.movetype!==2&&(o.movetype=2,o.optDown.outOffset&&o.optDown.outOffset(o),o.isMoveDown=!0),s>0?o.downHight+=s*o.optDown.outOffsetRate:o.downHight+=s),o.downHight=Math.round(o.downHight);let r=o.downHight/o.optDown.offset;o.optDown.onMoving&&o.optDown.onMoving(o,r,o.downHight)}o.lastPoint=l};i.prototype.touchendEvent=function(t){!this.optDown.use||(this.isMoveDown?(this.downHight>=this.optDown.offset?this.triggerDownScroll():(this.downHight=0,this.endDownScrollCall(this)),this.movetype=0,this.isMoveDown=!1):!this.isScrollBody&&this.getScrollTop()===this.startTop&&this.getPoint(t).y-this.startPoint.y<0&&this.getAngle(this.getPoint(t),this.startPoint)>80&&this.triggerUpScroll(!0))};i.prototype.getPoint=function(t){return t?t.touches&&t.touches[0]?{x:t.touches[0].pageX,y:t.touches[0].pageY}:t.changedTouches&&t.changedTouches[0]?{x:t.changedTouches[0].pageX,y:t.changedTouches[0].pageY}:{x:t.clientX,y:t.clientY}:{x:0,y:0}};i.prototype.getAngle=function(t,o){let e=Math.abs(t.x-o.x),l=Math.abs(t.y-o.y),n=Math.sqrt(e*e+l*l),s=0;return n!==0&&(s=Math.asin(l/n)/Math.PI*180),s};i.prototype.triggerDownScroll=function(){this.optDown.beforeLoading&&this.optDown.beforeLoading(this)||(this.showDownScroll(),!this.optDown.native&&this.optDown.callback&&this.optDown.callback(this))};i.prototype.showDownScroll=function(){this.isDownScrolling=!0,this.optDown.native?(p.index.startPullDownRefresh(),this.showDownLoadingCall(0)):(this.downHight=this.optDown.offset,this.showDownLoadingCall(this.downHight))};i.prototype.showDownLoadingCall=function(t){this.optDown.showLoading&&this.optDown.showLoading(this,t),this.optDown.afterLoading&&this.optDown.afterLoading(this,t)};i.prototype.onPullDownRefresh=function(){this.isDownScrolling=!0,this.showDownLoadingCall(0),this.optDown.callback&&this.optDown.callback(this)};i.prototype.endDownScroll=function(){if(this.optDown.native){this.isDownScrolling=!1,this.endDownScrollCall(this),p.index.stopPullDownRefresh();return}let t=this,o=function(){t.downHight=0,t.isDownScrolling=!1,t.endDownScrollCall(t),t.isScrollBody||(t.setScrollHeight(0),t.scrollTo(0,0))},e=0;t.optDown.beforeEndDownScroll&&(e=t.optDown.beforeEndDownScroll(t),t.isDownEndSuccess==null&&(e=0)),typeof e=="number"&&e>0?setTimeout(o,e):o()};i.prototype.endDownScrollCall=function(){this.optDown.endDownScroll&&this.optDown.endDownScroll(this),this.optDown.afterEndDownScroll&&this.optDown.afterEndDownScroll(this)};i.prototype.lockDownScroll=function(t){t==null&&(t=!0),this.optDown.isLock=t};i.prototype.lockUpScroll=function(t){t==null&&(t=!0),this.optUp.isLock=t};i.prototype.initUpScroll=function(){let t=this;t.optUp=t.options.up||{use:!1},!t.optUp.textColor&&t.hasColor(t.optUp.bgColor)&&(t.optUp.textColor="#fff"),t.extendUpScroll(t.optUp),t.optUp.use!==!1&&(t.optUp.hasNext=!0,t.startNum=t.optUp.page.num+1,t.optUp.inited&&setTimeout(function(){t.optUp.inited(t)},0))};i.prototype.onReachBottom=function(){this.isScrollBody&&!this.isUpScrolling&&!this.optUp.isLock&&this.optUp.hasNext&&this.triggerUpScroll()};i.prototype.onPageScroll=function(t){!this.isScrollBody||(this.setScrollTop(t.scrollTop),t.scrollTop>=this.optUp.toTop.offset?this.showTopBtn():this.hideTopBtn())};i.prototype.scroll=function(t,o){this.setScrollTop(t.scrollTop),this.setScrollHeight(t.scrollHeight),this.preScrollY==null&&(this.preScrollY=0),this.isScrollUp=t.scrollTop-this.preScrollY>0,this.preScrollY=t.scrollTop,this.isScrollUp&&this.triggerUpScroll(!0),t.scrollTop>=this.optUp.toTop.offset?this.showTopBtn():this.hideTopBtn(),this.optUp.onScroll&&o&&o()};i.prototype.triggerUpScroll=function(t){if(!this.isUpScrolling&&this.optUp.use&&this.optUp.callback){if(t===!0){let o=!1;if(this.optUp.hasNext&&!this.optUp.isLock&&!this.isDownScrolling&&this.getScrollBottom()<=this.optUp.offset&&(o=!0),o===!1)return}this.showUpScroll(),this.optUp.page.num++,this.isUpAutoLoad=!0,this.num=this.optUp.page.num,this.size=this.optUp.page.size,this.time=this.optUp.page.time,this.optUp.callback(this)}};i.prototype.showUpScroll=function(){this.isUpScrolling=!0,this.optUp.showLoading&&this.optUp.showLoading(this)};i.prototype.showNoMore=function(){this.optUp.hasNext=!1,this.optUp.showNoMore&&this.optUp.showNoMore(this)};i.prototype.hideUpScroll=function(){this.optUp.hideUpScroll&&this.optUp.hideUpScroll(this)};i.prototype.endUpScroll=function(t){t!=null&&(t?this.showNoMore():this.hideUpScroll()),this.isUpScrolling=!1};i.prototype.resetUpScroll=function(t){if(this.optUp&&this.optUp.use){let o=this.optUp.page;this.prePageNum=o.num,this.prePageTime=o.time,o.num=this.startNum,o.time=null,!this.isDownScrolling&&t!==!1&&(t==null?(this.removeEmpty(),this.showUpScroll()):this.showDownScroll()),this.isUpAutoLoad=!0,this.num=o.num,this.size=o.size,this.time=o.time,this.optUp.callback&&this.optUp.callback(this)}};i.prototype.setPageNum=function(t){this.optUp.page.num=t-1};i.prototype.setPageSize=function(t){this.optUp.page.size=t};i.prototype.endByPage=function(t,o,e){let l;this.optUp.use&&o!=null&&(l=this.optUp.page.num<o),this.endSuccess(t,l,e)};i.prototype.endBySize=function(t,o,e){let l;this.optUp.use&&o!=null&&(l=(this.optUp.page.num-1)*this.optUp.page.size+t<o),this.endSuccess(t,l,e)};i.prototype.endSuccess=function(t,o,e){let l=this;if(l.isDownScrolling&&(l.isDownEndSuccess=!0,l.endDownScroll()),l.optUp.use){let n;if(t!=null){let s=l.optUp.page.num,r=l.optUp.page.size;s===1&&e&&(l.optUp.page.time=e),t<r||o===!1?(l.optUp.hasNext=!1,t===0&&s===1?(n=!1,l.showEmpty()):((s-1)*r+t<l.optUp.noMoreSize?n=!1:n=!0,l.removeEmpty())):(n=!1,l.optUp.hasNext=!0,l.removeEmpty())}l.endUpScroll(n)}};i.prototype.endErr=function(t){if(this.isDownScrolling){this.isDownEndSuccess=!1;let o=this.optUp.page;o&&this.prePageNum&&(o.num=this.prePageNum,o.time=this.prePageTime),this.endDownScroll()}this.isUpScrolling&&(this.optUp.page.num--,this.endUpScroll(!1),this.isScrollBody&&t!==0&&(t||(t=this.optUp.errDistance),this.scrollTo(this.getScrollTop()-t,0)))};i.prototype.showEmpty=function(){this.optUp.empty.use&&this.optUp.empty.onShow&&this.optUp.empty.onShow(!0)};i.prototype.removeEmpty=function(){this.optUp.empty.use&&this.optUp.empty.onShow&&this.optUp.empty.onShow(!1)};i.prototype.showTopBtn=function(){this.topBtnShow||(this.topBtnShow=!0,this.optUp.toTop.onShow&&this.optUp.toTop.onShow(!0))};i.prototype.hideTopBtn=function(){this.topBtnShow&&(this.topBtnShow=!1,this.optUp.toTop.onShow&&this.optUp.toTop.onShow(!1))};i.prototype.getScrollTop=function(){return this.scrollTop||0};i.prototype.setScrollTop=function(t){this.scrollTop=t};i.prototype.scrollTo=function(t,o){this.myScrollTo&&this.myScrollTo(t,o)};i.prototype.resetScrollTo=function(t){this.myScrollTo=t};i.prototype.getScrollBottom=function(){return this.getScrollHeight()-this.getClientHeight()-this.getScrollTop()};i.prototype.getStep=function(t,o,e,l,n){let s=o-t;if(l===0||s===0){e&&e(o);return}l=l||300,n=n||30;let r=l/n,c=s/r,h=0,u=setInterval(function(){h<r-1?(t+=c,e&&e(t,u),h++):(e&&e(o,u),clearInterval(u))},n)};i.prototype.getClientHeight=function(t){let o=this.clientHeight||0;return o===0&&t!==!0&&(o=this.getBodyHeight()),o};i.prototype.setClientHeight=function(t){this.clientHeight=t};i.prototype.getScrollHeight=function(){return this.scrollHeight||0};i.prototype.setScrollHeight=function(t){this.scrollHeight=t};i.prototype.getBodyHeight=function(){return this.bodyHeight||0};i.prototype.setBodyHeight=function(t){this.bodyHeight=t};i.prototype.preventDefault=function(t){t&&t.cancelable&&!t.defaultPrevented&&t.preventDefault()};const S=t=>{t.wxsCallMethods||(t.wxsCallMethods=[]),t.wxsCallMethods.push("wxsCall")},T=()=>"./components/mescroll-top.js",y={name:"mescroll-uni",mixins:[x.WxsMixin],components:{MescrollTop:T},props:{down:Object,up:Object,i18n:Object,top:[String,Number],topbar:[Boolean,String],bottom:[String,Number],safearea:Boolean,fixed:{type:Boolean,default:!0},height:[String,Number],bottombar:{type:Boolean,default:!0},disableScroll:Boolean},data(){return{mescroll:{optDown:{},optUp:{}},viewId:"id_"+Math.random().toString(36).substr(2,16),downHight:0,downRate:0,downLoadType:0,upLoadType:0,isShowEmpty:!1,isShowToTop:!1,scrollTop:0,scrollAnim:!1,windowTop:0,windowBottom:0,windowHeight:0,statusBarHeight:0}},computed:{isFixed(){return!this.height&&this.fixed},scrollHeight(){return this.isFixed?"auto":this.height?this.toPx(this.height)+"px":"100%"},numTop(){return this.toPx(this.top)},fixedTop(){return this.isFixed?this.numTop+this.windowTop+"px":0},padTop(){return this.isFixed?0:this.numTop+"px"},numBottom(){return this.toPx(this.bottom)},fixedBottom(){return this.isFixed?this.numBottom+this.windowBottom+"px":0},padBottom(){return this.isFixed?0:this.numBottom+"px"},isDownReset(){return this.downLoadType===3||this.downLoadType===4},transition(){return this.isDownReset?"transform 300ms":""},translateY(){return this.downHight>0?"translateY("+this.downHight+"px)":""},scrollable(){return this.disableScroll?!1:this.downLoadType===0||this.isDownReset},isDownLoading(){return this.downLoadType===3},downRotate(){return"rotate("+360*this.downRate+"deg)"},downText(){if(!this.mescroll)return"";switch(this.downLoadType){case 1:return this.mescroll.optDown.textInOffset;case 2:return this.mescroll.optDown.textOutOffset;case 3:return this.mescroll.optDown.textLoading;case 4:return this.mescroll.isDownEndSuccess?this.mescroll.optDown.textSuccess:this.mescroll.isDownEndSuccess==!1?this.mescroll.optDown.textErr:this.mescroll.optDown.textInOffset;default:return this.mescroll.optDown.textInOffset}}},methods:{toPx(t){if(typeof t=="string"){if(t.indexOf("px")!==-1)if(t.indexOf("rpx")!==-1)t=t.replace("rpx","");else if(t.indexOf("upx")!==-1)t=t.replace("upx","");else return Number(t.replace("px",""));else if(t.indexOf("%")!==-1){let o=Number(t.replace("%",""))/100;return this.windowHeight*o}}return t?p.index.upx2px(Number(t)):0},scroll(t){this.mescroll.scroll(t.detail,()=>{this.$emit("scroll",this.mescroll)})},emptyClick(){this.$emit("emptyclick",this.mescroll)},toTopClick(){this.mescroll.scrollTo(0,this.mescroll.optUp.toTop.duration),this.$emit("topclick",this.mescroll)},setClientHeight(){this.mescroll.getClientHeight(!0)===0&&!this.isExec&&(this.isExec=!0,this.$nextTick(()=>{this.getClientInfo(t=>{this.isExec=!1,t?this.mescroll.setClientHeight(t.height):this.clientNum!=3&&(this.clientNum=this.clientNum==null?1:this.clientNum+1,setTimeout(()=>{this.setClientHeight()},this.clientNum*100))})}))},getClientInfo(t){let o=p.index.createSelectorQuery();o=o.in(this),o.select("#"+this.viewId).boundingClientRect(l=>{t(l)}).exec()}},created(){let t=this,o={down:{inOffset(){t.downLoadType=1},outOffset(){t.downLoadType=2},onMoving(r,c,h){t.downHight=h,t.downRate=c},showLoading(r,c){t.downLoadType=3,t.downHight=c},beforeEndDownScroll(r){return t.downLoadType=4,r.optDown.beforeEndDelay},endDownScroll(){t.downLoadType=4,t.downHight=0,t.downResetTimer&&clearTimeout(t.downResetTimer),t.downResetTimer=setTimeout(()=>{t.downLoadType===4&&(t.downLoadType=0)},300)},callback:function(r){t.$emit("down",r)}},up:{showLoading(){t.upLoadType=1},showNoMore(){t.upLoadType=2},hideUpScroll(r){t.upLoadType=r.optUp.hasNext?0:3},empty:{onShow(r){t.isShowEmpty=r}},toTop:{onShow(r){t.isShowToTop=r}},callback:function(r){t.$emit("up",r),t.setClientHeight()}}},e=g.mescrollI18n.getType(),l={type:e};i.extend(l,t.i18n),i.extend(l,w.GlobalOption.i18n),i.extend(o,l[e]),i.extend(o,{down:w.GlobalOption.down,up:w.GlobalOption.up});let n=JSON.parse(JSON.stringify({down:t.down,up:t.up}));i.extend(n,o),t.mescroll=new i(n),t.mescroll.viewId=t.viewId,t.mescroll.i18n=l,t.$emit("init",t.mescroll);const s=p.index.getSystemInfoSync();s.windowTop&&(t.windowTop=s.windowTop),s.windowBottom&&(t.windowBottom=s.windowBottom),s.windowHeight&&(t.windowHeight=s.windowHeight),s.statusBarHeight&&(t.statusBarHeight=s.statusBarHeight),t.mescroll.setBodyHeight(s.windowHeight),t.mescroll.resetScrollTo((r,c)=>{if(t.scrollAnim=c!==0,typeof r=="string"){t.getClientInfo(function(u){let D=u.top,f;r.indexOf("#")==-1&&r.indexOf(".")==-1?f="#"+r:f=r,p.index.createSelectorQuery().select(f).boundingClientRect(function(d){if(d){let m=t.mescroll.getScrollTop(),a=d.top-D;a+=m,t.isFixed||(a-=t.numTop),t.scrollTop=m,t.$nextTick(function(){t.scrollTop=a})}else console.error(f+" does not exist")}).exec()});return}let h=t.mescroll.getScrollTop();c===0||c===300?(t.scrollTop=h,t.$nextTick(function(){t.scrollTop=r})):t.mescroll.getStep(h,r,u=>{t.scrollTop=u},c)}),t.up&&t.up.toTop&&t.up.toTop.safearea!=null||(t.mescroll.optUp.toTop.safearea=t.safearea),p.index.$on("setMescrollGlobalOption",r=>{if(!r)return;let c=r.i18n?r.i18n.type:null;if(c&&t.mescroll.i18n.type!=c&&(t.mescroll.i18n.type=c,g.mescrollI18n.setType(c),i.extend(r,t.mescroll.i18n[c])),r.down){let h=i.extend({},r.down);t.mescroll.optDown=i.extend(h,t.mescroll.optDown)}if(r.up){let h=i.extend({},r.up);t.mescroll.optUp=i.extend(h,t.mescroll.optUp)}})},mounted(){this.setClientHeight()},destroyed(){p.index.$off("setMescrollGlobalOption")}};if(!Array){const t=p.resolveComponent("mescroll-empty"),o=p.resolveComponent("mescroll-top");(t+o)()}const U=()=>"../mescroll-empty/mescroll-empty.js";Math||U();function b(t,o,e,l,n,s){return p.e({a:e.topbar&&n.statusBarHeight},e.topbar&&n.statusBarHeight?{b:n.statusBarHeight+"px",c:e.topbar}:{},{d:n.mescroll.optDown.use},n.mescroll.optDown.use?{e:s.isDownLoading?1:"",f:n.mescroll.optDown.textColor,g:s.downRotate,h:p.t(s.downText),i:n.mescroll.optDown.bgColor,j:n.mescroll.optDown.textColor}:{},{k:n.isShowEmpty},n.isShowEmpty?{l:p.o(s.emptyClick),m:p.p({option:n.mescroll.optUp.empty})}:{},{n:n.mescroll.optUp.use&&!s.isDownLoading&&n.upLoadType!==3},n.mescroll.optUp.use&&!s.isDownLoading&&n.upLoadType!==3?p.e({o:n.mescroll.optUp.textColor,p:p.t(n.mescroll.optUp.textLoading),q:n.upLoadType===1,r:n.upLoadType===2},n.upLoadType===2?{s:p.t(n.mescroll.optUp.textNoMore)}:{},{t:n.mescroll.optUp.bgColor,v:n.mescroll.optUp.textColor}):{},{w:s.translateY,x:s.transition,y:t.callProp,z:e.safearea},e.safearea?{}:{},{A:t.wxsProp,B:n.viewId,C:s.isFixed?1:"",D:s.scrollHeight,E:s.padTop,F:s.padBottom,G:s.fixedTop,H:s.fixedBottom,I:n.scrollTop,J:n.scrollAnim,K:p.o((...r)=>s.scroll&&s.scroll(...r)),L:s.scrollable,M:p.o(s.toTopClick),N:p.o(r=>n.isShowToTop=r),O:p.p({option:n.mescroll.optUp.toTop,modelValue:n.isShowToTop}),P:t.renderBiz.propObserver,Q:t.wxsProp})}typeof S=="function"&&S(y);const H=p._export_sfc(y,[["render",b],["__file","D:/WeChatProj/uni_app/NetEaseMusic/uni_modules/mescroll-uni/components/mescroll-uni/mescroll-uni.vue"]]);wx.createComponent(H);
